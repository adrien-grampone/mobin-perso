{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/adriengrampone/Documents/A&F/mobin/frontend/pages/auth/proposer-document/index.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState, useCallback, useContext } from 'react';\nimport { Container, Box, Grid, LinearProgress, Button, Paper, Divider, TextField, FormControl, Select, InputLabel, MenuItem } from '@material-ui/core';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useDropzone } from 'react-dropzone';\nimport { Layout, Text } from '../../../components';\nimport { postDocumentAdherent } from '../../../lib/ressources';\nimport AppContext from '../../../context/AppContext';\nimport { sendResourceNotif } from '../../../src/services/sendEmail';\nvar useStyles = makeStyles(function (theme) {\n  return {\n    paper: {\n      padding: '2em',\n      border: \"2px solid \".concat(theme.palette.grey.main)\n    },\n    paper2: {\n      padding: '2em',\n      border: \"0.5px solid \".concat(theme.palette.blue.main)\n    },\n    flexBox: {\n      display: 'flex',\n      alignItems: 'center'\n    },\n    textField: {\n      minWidth: '100%'\n    },\n    textFieldBox: {// textAlign: 'center'\n    },\n    btnBox: {\n      textAlign: 'center'\n    },\n    btn: {\n      paddingLeft: '2em',\n      paddingRight: '2em',\n      color: theme.palette.blue.main,\n      fontWeight: 'bold',\n      letterSpacing: '2px',\n      borderColor: theme.palette.grey.main,\n      borderRadius: '1.5em',\n      '&:hover': {\n        backgroundColor: theme.palette.golden.main,\n        color: '#fff',\n        borderColor: theme.palette.golden.main\n      }\n    }\n  };\n});\n\nvar PrivateShareDocument = function PrivateShareDocument(_ref) {\n  _s();\n\n  var _variables$fichier;\n\n  var _ref$themes = _ref.themes,\n      themes = _ref$themes === void 0 ? [] : _ref$themes,\n      _ref$contactEmails = _ref.contactEmails,\n      contactEmails = _ref$contactEmails === void 0 ? [] : _ref$contactEmails;\n  var classes = useStyles();\n\n  var _useContext = useContext(AppContext),\n      user = _useContext.user;\n\n  var initialState = {\n    titre: '',\n    thematique: {},\n    fichier: null\n  };\n\n  var _useState = useState(initialState),\n      variables = _useState[0],\n      setVariables = _useState[1];\n\n  var _useState2 = useState(false),\n      loader = _useState2[0],\n      setLoader = _useState2[1];\n\n  var _useState3 = useState(null),\n      error = _useState3[0],\n      setError = _useState3[1];\n\n  var _useState4 = useState(null),\n      success = _useState4[0],\n      setSuccess = _useState4[1];\n\n  var onDrop = useCallback(function (acceptedFiles) {\n    setVariables(_objectSpread(_objectSpread({}, variables), {}, {\n      fichier: acceptedFiles[0]\n    }));\n  }, []);\n\n  var _useDropzone = useDropzone({\n    onDrop: onDrop,\n    accept: '.pdf'\n  }),\n      getRootProps = _useDropzone.getRootProps,\n      getInputProps = _useDropzone.getInputProps,\n      isDragActive = _useDropzone.isDragActive;\n\n  var onSubmit = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var titre, thematique, fichier, _response$data, _response$data$themat, formData, data, response, emails, _variables, res;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setLoader(true);\n              titre = variables.titre, thematique = variables.thematique, fichier = variables.fichier;\n              setError(null);\n\n              if (fichier) {\n                _context.next = 7;\n                break;\n              }\n\n              setLoader(false);\n              setError('Merci de télécharger un document pdf.');\n              return _context.abrupt(\"return\");\n\n            case 7:\n              if (!(titre.length < 1)) {\n                _context.next = 11;\n                break;\n              }\n\n              setLoader(false);\n              setError('Un titre de document doit être saisi.');\n              return _context.abrupt(\"return\");\n\n            case 11:\n              if (!(Object.keys(thematique).length < 1)) {\n                _context.next = 15;\n                break;\n              }\n\n              setLoader(false);\n              setError('Merci de choisir une thématique.');\n              return _context.abrupt(\"return\");\n\n            case 15:\n              _context.prev = 15;\n              // 1. Create Form Data with Document\n              formData = new FormData();\n              formData.append('files.fichier', fichier, fichier.name);\n              data = {};\n              data.titre = titre;\n              data.thematique = thematique.id;\n              formData.append('data', JSON.stringify(data)); // 2. Post Form Data\n\n              _context.next = 24;\n              return postDocumentAdherent(formData);\n\n            case 24:\n              response = _context.sent;\n              // 3. Send Email Notif\n              emails = contactEmails.map(function (e) {\n                return {\n                  email: e.email\n                };\n              });\n              _variables = {\n                message: \"L'utilisateur \".concat(user.email, \" a d\\xE9pos\\xE9 un nouveau document dans l'espace adh\\xE9rents, section \").concat((response === null || response === void 0 ? void 0 : (_response$data = response.data) === null || _response$data === void 0 ? void 0 : (_response$data$themat = _response$data.thematique) === null || _response$data$themat === void 0 ? void 0 : _response$data$themat.titre) || 'inconnue', \".\"),\n                emails: emails,\n                senderEmail: user.email\n              };\n              _context.next = 29;\n              return sendResourceNotif(_variables);\n\n            case 29:\n              res = _context.sent;\n              // 4. Set Loader to false and success and variable to initial state\n              setVariables(initialState);\n              setSuccess('Votre document a bien été envoyé !');\n              setLoader(false);\n              _context.next = 40;\n              break;\n\n            case 35:\n              _context.prev = 35;\n              _context.t0 = _context[\"catch\"](15);\n              console.log(_context.t0);\n              setLoader(false);\n              setError('Impossible de télécharger le document. Veuillez réessayer.');\n\n            case 40:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[15, 35]]);\n    }));\n\n    return function onSubmit() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  if (loader) {\n    return /*#__PURE__*/_jsxDEV(LinearProgress, {\n      color: \"primary\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 7\n    }, _this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(Layout, {\n    children: /*#__PURE__*/_jsxDEV(Box, {\n      mt: 7,\n      children: /*#__PURE__*/_jsxDEV(Container, {\n        maxWidth: \"lg\",\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          direction: \"column\",\n          justify: \"center\",\n          alignItems: \"center\",\n          children: /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            xs: 10,\n            md: 8,\n            children: /*#__PURE__*/_jsxDEV(Paper, {\n              className: classes.paper,\n              children: [/*#__PURE__*/_jsxDEV(Box, {\n                mb: 2,\n                children: /*#__PURE__*/_jsxDEV(Text, {\n                  size: \"h5\",\n                  letterspacing: \"2px\",\n                  bold: true,\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    style: {\n                      color: '#e95e2e'\n                    },\n                    children: \"Proposer une ressource\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 148,\n                    columnNumber: 21\n                  }, _this), ' ', /*#__PURE__*/_jsxDEV(\"span\", {\n                    style: {\n                      color: '#2699b0'\n                    },\n                    children: \"au r\\xE9seau\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 150,\n                    columnNumber: 21\n                  }, _this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 147,\n                  columnNumber: 19\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 146,\n                columnNumber: 17\n              }, _this), /*#__PURE__*/_jsxDEV(Box, {\n                mb: 4,\n                children: /*#__PURE__*/_jsxDEV(Text, {\n                  size: \"body2\",\n                  bold: true,\n                  color: \"#4ba829\",\n                  children: \"Vous avez un nouveau projet, vous venez de signer une nouvelle convention, vous avez un article dans la presse, vous avez recrut\\xE9 un nouvel adh\\xE9rent, toutes les actualit\\xE9s sont les bienvenues ! N'h\\xE9sitez pas \\xE0 d\\xE9poser un fichier en format PDF pour que Mob'In en soit inform\\xE9 et puisse diffuser cette actualit\\xE9 aux autres membres du r\\xE9seau. Merci d'avance !\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 154,\n                  columnNumber: 19\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 153,\n                columnNumber: 17\n              }, _this), /*#__PURE__*/_jsxDEV(Divider, {\n                color: \"#b1b3b4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 158,\n                columnNumber: 17\n              }, _this), /*#__PURE__*/_jsxDEV(Box, {\n                mt: 3,\n                mb: 2,\n                className: classes.textFieldBox,\n                children: [/*#__PURE__*/_jsxDEV(Box, {\n                  mt: 2,\n                  mb: 2,\n                  children: /*#__PURE__*/_jsxDEV(Text, {\n                    bold: true,\n                    size: \"body2\",\n                    children: \"T\\xE9l\\xE9charger un fichier\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 165,\n                    columnNumber: 21\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 164,\n                  columnNumber: 19\n                }, _this), /*#__PURE__*/_jsxDEV(Box, {\n                  mb: 3,\n                  children: /*#__PURE__*/_jsxDEV(Paper, {\n                    variant: \"outlined\",\n                    className: classes.paper2,\n                    children: /*#__PURE__*/_jsxDEV(\"div\", _objectSpread(_objectSpread({}, getRootProps()), {}, {\n                      children: [/*#__PURE__*/_jsxDEV(\"input\", _objectSpread({}, getInputProps()), void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 175,\n                        columnNumber: 27\n                      }, _this), isDragActive ? /*#__PURE__*/_jsxDEV(Text, {\n                        children: \"T\\xE9l\\xE9chargez votre fichier PDF ici\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 178,\n                        columnNumber: 57\n                      }, _this) : /*#__PURE__*/_jsxDEV(Text, {\n                        children: \"T\\xE9l\\xE9chargez votre fichier PDF ici\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 179,\n                        columnNumber: 57\n                      }, _this), variables.fichier && /*#__PURE__*/_jsxDEV(Text, {\n                        bold: true,\n                        children: variables === null || variables === void 0 ? void 0 : (_variables$fichier = variables.fichier) === null || _variables$fichier === void 0 ? void 0 : _variables$fichier.name\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 183,\n                        columnNumber: 53\n                      }, _this)]\n                    }), void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 174,\n                      columnNumber: 23\n                    }, _this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 170,\n                    columnNumber: 21\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 169,\n                  columnNumber: 19\n                }, _this), /*#__PURE__*/_jsxDEV(Box, {\n                  mb: 2,\n                  children: /*#__PURE__*/_jsxDEV(TextField, {\n                    value: variables.titre,\n                    onChange: function onChange(event) {\n                      return setVariables(_objectSpread(_objectSpread({}, variables), {}, {\n                        titre: event.target.value\n                      }));\n                    },\n                    label: \"Titre\",\n                    variant: \"outlined\",\n                    size: \"small\",\n                    className: classes.textField\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 190,\n                    columnNumber: 21\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 189,\n                  columnNumber: 19\n                }, _this), /*#__PURE__*/_jsxDEV(Box, {\n                  mb: 3,\n                  children: /*#__PURE__*/_jsxDEV(FormControl, {\n                    className: classes.textField,\n                    children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n                      children: \"Th\\xE8me\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 203,\n                      columnNumber: 23\n                    }, _this), /*#__PURE__*/_jsxDEV(Select, {\n                      value: variables.thematique || '',\n                      onChange: function onChange(event) {\n                        return setVariables(_objectSpread(_objectSpread({}, variables), {}, {\n                          thematique: event.target.value\n                        }));\n                      },\n                      children: themes.map(function (t, i) {\n                        return /*#__PURE__*/_jsxDEV(MenuItem, {\n                          value: t,\n                          children: t.titre\n                        }, i, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 210,\n                          columnNumber: 55\n                        }, _this);\n                      })\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 204,\n                      columnNumber: 23\n                    }, _this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 200,\n                    columnNumber: 21\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 199,\n                  columnNumber: 19\n                }, _this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 159,\n                columnNumber: 17\n              }, _this), error && /*#__PURE__*/_jsxDEV(Box, {\n                mt: 3,\n                mb: 2,\n                children: /*#__PURE__*/_jsxDEV(Text, {\n                  size: \"body1\",\n                  bold: true,\n                  color: \"#e5352c\",\n                  children: error\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 226,\n                  columnNumber: 39\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 225,\n                columnNumber: 37\n              }, _this), success && /*#__PURE__*/_jsxDEV(Box, {\n                mt: 3,\n                mb: 2,\n                children: /*#__PURE__*/_jsxDEV(Text, {\n                  size: \"body1\",\n                  bold: true,\n                  color: \"#4ba829\",\n                  children: success\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 235,\n                  columnNumber: 39\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 234,\n                columnNumber: 37\n              }, _this), /*#__PURE__*/_jsxDEV(Box, {\n                mt: 3,\n                mb: 2,\n                className: classes.btnBox,\n                children: /*#__PURE__*/_jsxDEV(Button, {\n                  className: classes.btn,\n                  variant: \"outlined\",\n                  onClick: function onClick() {\n                    return onSubmit();\n                  },\n                  children: \"Valider\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 246,\n                  columnNumber: 19\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 241,\n                columnNumber: 17\n              }, _this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 145,\n              columnNumber: 15\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 135,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(PrivateShareDocument, \"QhtCSf2IkeW4QY/qoik1NHNjDcA=\", false, function () {\n  return [useStyles, useDropzone];\n});\n\n_c = PrivateShareDocument;\nexport var __N_SSP = true;\nexport default PrivateShareDocument;\n\nvar _c;\n\n$RefreshReg$(_c, \"PrivateShareDocument\");","map":{"version":3,"sources":["/Users/adriengrampone/Documents/A&F/mobin/frontend/pages/auth/proposer-document/index.js"],"names":["useState","useCallback","useContext","Container","Box","Grid","LinearProgress","Button","Paper","Divider","TextField","FormControl","Select","InputLabel","MenuItem","makeStyles","useDropzone","Layout","Text","postDocumentAdherent","AppContext","sendResourceNotif","useStyles","theme","paper","padding","border","palette","grey","main","paper2","blue","flexBox","display","alignItems","textField","minWidth","textFieldBox","btnBox","textAlign","btn","paddingLeft","paddingRight","color","fontWeight","letterSpacing","borderColor","borderRadius","backgroundColor","golden","PrivateShareDocument","themes","contactEmails","classes","user","initialState","titre","thematique","fichier","variables","setVariables","loader","setLoader","error","setError","success","setSuccess","onDrop","acceptedFiles","accept","getRootProps","getInputProps","isDragActive","onSubmit","length","Object","keys","formData","FormData","append","name","data","id","JSON","stringify","response","emails","map","e","email","message","senderEmail","res","console","log","event","target","value","t","i"],"mappings":"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","sourcesContent":["import { useState, useCallback, useContext } from 'react';\nimport {\n  Container, Box, Grid, LinearProgress, Button, Paper, Divider, TextField, FormControl, Select, InputLabel, MenuItem,\n} from '@material-ui/core';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useDropzone } from 'react-dropzone';\nimport Cookies from 'cookies';\nimport { Layout, Text } from '../../../components';\nimport { getThemes, getContactEmails, isTokenValid } from '../../../utils';\nimport { postDocumentAdherent } from '../../../lib/ressources';\nimport AppContext from '../../../context/AppContext';\nimport { sendResourceNotif } from '../../../src/services/sendEmail';\n\nconst useStyles = makeStyles((theme) => ({\n  paper: {\n    padding: '2em',\n    border: `2px solid ${theme.palette.grey.main}`,\n  },\n  paper2: {\n    padding: '2em',\n    border: `0.5px solid ${theme.palette.blue.main}`,\n  },\n  flexBox: {\n    display: 'flex',\n    alignItems: 'center',\n  },\n  textField: {\n    minWidth: '100%',\n  },\n  textFieldBox: {\n    // textAlign: 'center'\n  },\n  btnBox: {\n    textAlign: 'center',\n  },\n  btn: {\n    paddingLeft: '2em',\n    paddingRight: '2em',\n    color: theme.palette.blue.main,\n    fontWeight: 'bold',\n    letterSpacing: '2px',\n    borderColor: theme.palette.grey.main,\n    borderRadius: '1.5em',\n    '&:hover': {\n      backgroundColor: theme.palette.golden.main,\n      color: '#fff',\n      borderColor: theme.palette.golden.main,\n    },\n  },\n}));\n\nconst PrivateShareDocument = ({ themes = [], contactEmails = [] }) => {\n  const classes = useStyles();\n  const { user } = useContext(AppContext);\n  const initialState = {\n    titre: '',\n    thematique: {},\n    fichier: null,\n  };\n  const [variables, setVariables] = useState(initialState);\n  const [loader, setLoader] = useState(false);\n  const [error, setError] = useState(null);\n  const [success, setSuccess] = useState(null);\n\n  const onDrop = useCallback((acceptedFiles) => {\n    setVariables({ ...variables, fichier: acceptedFiles[0] });\n  }, []);\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: '.pdf',\n  });\n\n  const onSubmit = async () => {\n    setLoader(true);\n    const { titre, thematique, fichier } = variables;\n    setError(null);\n\n    if (!fichier) {\n      setLoader(false);\n      setError('Merci de télécharger un document pdf.');\n      return;\n    }\n\n    if (titre.length < 1) {\n      setLoader(false);\n      setError('Un titre de document doit être saisi.');\n      return;\n    }\n\n    if (Object.keys(thematique).length < 1) {\n      setLoader(false);\n      setError('Merci de choisir une thématique.');\n      return;\n    }\n\n    try {\n      // 1. Create Form Data with Document\n      const formData = new FormData();\n      formData.append('files.fichier', fichier, fichier.name);\n      const data = {};\n      data.titre = titre;\n      data.thematique = thematique.id;\n      formData.append('data', JSON.stringify(data));\n\n      // 2. Post Form Data\n      const response = await postDocumentAdherent(formData);\n\n      // 3. Send Email Notif\n      const emails = contactEmails.map((e) => ({ email: e.email }));\n      const variables = {\n        message: `L'utilisateur ${user.email} a déposé un nouveau document dans l'espace adhérents, section ${response?.data?.thematique?.titre || 'inconnue'}.`,\n        emails,\n        senderEmail: user.email,\n      };\n      const res = await sendResourceNotif(variables);\n      // 4. Set Loader to false and success and variable to initial state\n      setVariables(initialState);\n      setSuccess('Votre document a bien été envoyé !');\n      setLoader(false);\n    } catch (error) {\n      console.log(error);\n      setLoader(false);\n      setError('Impossible de télécharger le document. Veuillez réessayer.');\n    }\n  };\n\n  if (loader) {\n    return (\n      <LinearProgress color=\"primary\" />\n    );\n  }\n\n  return (\n    <Layout>\n      <Box mt={7}>\n        <Container maxWidth=\"lg\">\n          <Grid\n            container\n            direction=\"column\"\n            justify=\"center\"\n            alignItems=\"center\"\n          >\n            <Grid item xs={10} md={8}>\n              <Paper className={classes.paper}>\n                <Box mb={2}>\n                  <Text size=\"h5\" letterspacing=\"2px\" bold>\n                    <span style={{ color: '#e95e2e' }}>Proposer une ressource</span>\n                    {' '}\n                    <span style={{ color: '#2699b0' }}>au réseau</span>\n                  </Text>\n                </Box>\n                <Box mb={4}>\n                  <Text size=\"body2\" bold color=\"#4ba829\">\n                    Vous avez un nouveau projet, vous venez de signer une nouvelle convention, vous avez un article dans la presse, vous avez recruté un nouvel adhérent, toutes les actualités sont les bienvenues ! N'hésitez pas à déposer un fichier en format PDF pour que Mob'In en soit informé et puisse diffuser cette actualité aux autres membres du réseau. Merci d'avance !\n                  </Text>\n                </Box>\n                <Divider color=\"#b1b3b4\" />\n                <Box\n                  mt={3}\n                  mb={2}\n                  className={classes.textFieldBox}\n                >\n                  <Box mt={2} mb={2}>\n                    <Text bold size=\"body2\">\n                      Télécharger un fichier\n                                        </Text>\n                  </Box>\n                  <Box mb={3}>\n                    <Paper\n                      variant=\"outlined\"\n                      className={classes.paper2}\n                    >\n                      <div {...getRootProps()}>\n                          <input {...getInputProps()} />\n                          {\n                                                    isDragActive\n                                                      ? <Text>Téléchargez votre fichier PDF ici</Text>\n                                                      : <Text>Téléchargez votre fichier PDF ici</Text>\n                                                }\n                          {\n                                                    variables.fichier && (\n                                                    <Text bold>{variables?.fichier?.name}</Text>\n                                                    )\n                                                }\n                        </div>\n                    </Paper>\n                  </Box>\n                  <Box mb={2}>\n                    <TextField\n                      value={variables.titre}\n                      onChange={(event) => setVariables({ ...variables, titre: event.target.value })}\n                      label=\"Titre\"\n                      variant=\"outlined\"\n                      size=\"small\"\n                      className={classes.textField}\n                    />\n                  </Box>\n                  <Box mb={3}>\n                    <FormControl\n                      className={classes.textField}\n                    >\n                      <InputLabel>Thème</InputLabel>\n                      <Select\n                          value={variables.thematique || ''}\n                          onChange={(event) => setVariables({ ...variables, thematique: event.target.value })}\n                        >\n                          {\n                                                    themes.map((t, i) => (\n                                                      <MenuItem\n                                                        key={i}\n                                                        value={t}\n                                                      >\n                                                        {t.titre}\n                                                      </MenuItem>\n                                                    ))\n                                                }\n                        </Select>\n                    </FormControl>\n                  </Box>\n\n                </Box>\n                {\n                                    error && (\n                                    <Box mt={3} mb={2}>\n                                      <Text size=\"body1\" bold color=\"#e5352c\">\n                                        {error}\n                                      </Text>\n                                    </Box>\n                                    )\n                                }\n                {\n                                    success && (\n                                    <Box mt={3} mb={2}>\n                                      <Text size=\"body1\" bold color=\"#4ba829\">\n                                        {success}\n                                      </Text>\n                                    </Box>\n                                    )\n                                }\n                <Box\n                  mt={3}\n                  mb={2}\n                  className={classes.btnBox}\n                >\n                  <Button className={classes.btn} variant=\"outlined\" onClick={() => onSubmit()}>\n                    Valider\n                  </Button>\n                </Box>\n              </Paper>\n            </Grid>\n          </Grid>\n        </Container>\n      </Box>\n    </Layout>\n  );\n};\n\nexport const getServerSideProps = async (ctx) => {\n  const req = ctx.req ? ctx.req : null;\n  if (req) {\n    const cookies = new Cookies(ctx.req, ctx.res);\n    const token = cookies.get('token');\n    if (token) {\n      const isTokValid = isTokenValid(token);\n      if (isTokValid) {\n        const res = await fetch(getThemes);\n        const themes = await res.json();\n        const res2 = await fetch(getContactEmails);\n        const emails = await res2.json();\n        return {\n          props: { themes, contactEmails: emails },\n        };\n      }\n      ctx.res.writeHead(302, { Location: '/' });\n      ctx.res.end();\n      return { props: {} };\n    }\n    ctx.res.writeHead(302, { Location: '/' });\n    ctx.res.end();\n    return { props: {} };\n  }\n};\n\nexport default PrivateShareDocument;\n"]},"metadata":{},"sourceType":"module"}