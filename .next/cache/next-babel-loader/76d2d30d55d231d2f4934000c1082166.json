{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/adriengrampone/Documents/A&F/mobin/frontend/pages/auth/proposer-document/index.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useState, useCallback, useContext } from 'react';\nimport { Container, Box, Grid, LinearProgress, Button, Paper, Divider, TextField, FormControl, Select, InputLabel, MenuItem } from '@material-ui/core';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useDropzone } from 'react-dropzone';\nimport Cookies from 'cookies';\nimport { Layout, Text } from '../../../components';\nimport { getThemes, getContactEmails, isTokenValid } from '../../../utils';\nimport { postDocumentAdherent } from '../../../lib/ressources';\nimport AppContext from '../../../context/AppContext';\nimport { sendResourceNotif } from '../../../src/services/sendEmail';\nconst useStyles = makeStyles(theme => ({\n  paper: {\n    padding: '2em',\n    border: `2px solid ${theme.palette.grey.main}`\n  },\n  paper2: {\n    padding: '2em',\n    border: `0.5px solid ${theme.palette.blue.main}`\n  },\n  flexBox: {\n    display: 'flex',\n    alignItems: 'center'\n  },\n  textField: {\n    minWidth: '100%'\n  },\n  textFieldBox: {// textAlign: 'center'\n  },\n  btnBox: {\n    textAlign: 'center'\n  },\n  btn: {\n    paddingLeft: '2em',\n    paddingRight: '2em',\n    color: theme.palette.blue.main,\n    fontWeight: 'bold',\n    letterSpacing: '2px',\n    borderColor: theme.palette.grey.main,\n    borderRadius: '1.5em',\n    '&:hover': {\n      backgroundColor: theme.palette.golden.main,\n      color: '#fff',\n      borderColor: theme.palette.golden.main\n    }\n  }\n}));\n\nconst PrivateShareDocument = ({\n  themes = [],\n  contactEmails = []\n}) => {\n  var _variables$fichier;\n\n  const classes = useStyles();\n  const {\n    user\n  } = useContext(AppContext);\n  const initialState = {\n    titre: '',\n    thematique: {},\n    fichier: null\n  };\n  const {\n    0: variables,\n    1: setVariables\n  } = useState(initialState);\n  const {\n    0: loader,\n    1: setLoader\n  } = useState(false);\n  const {\n    0: error,\n    1: setError\n  } = useState(null);\n  const {\n    0: success,\n    1: setSuccess\n  } = useState(null);\n  const onDrop = useCallback(acceptedFiles => {\n    setVariables(_objectSpread(_objectSpread({}, variables), {}, {\n      fichier: acceptedFiles[0]\n    }));\n  }, []);\n  const {\n    getRootProps,\n    getInputProps,\n    isDragActive\n  } = useDropzone({\n    onDrop,\n    accept: '.pdf'\n  });\n\n  const onSubmit = async () => {\n    setLoader(true);\n    const {\n      titre,\n      thematique,\n      fichier\n    } = variables;\n    setError(null);\n\n    if (!fichier) {\n      setLoader(false);\n      setError('Merci de télécharger un document pdf.');\n      return;\n    }\n\n    if (titre.length < 1) {\n      setLoader(false);\n      setError('Un titre de document doit être saisi.');\n      return;\n    }\n\n    if (Object.keys(thematique).length < 1) {\n      setLoader(false);\n      setError('Merci de choisir une thématique.');\n      return;\n    }\n\n    try {\n      var _response$data, _response$data$themat;\n\n      // 1. Create Form Data with Document\n      const formData = new FormData();\n      formData.append('files.fichier', fichier, fichier.name);\n      const data = {};\n      data.titre = titre;\n      data.thematique = thematique.id;\n      formData.append('data', JSON.stringify(data)); // 2. Post Form Data\n\n      const response = await postDocumentAdherent(formData); // 3. Send Email Notif\n\n      const emails = contactEmails.map(e => ({\n        email: e.email\n      }));\n      const variables = {\n        message: `L'utilisateur ${user.email} a déposé un nouveau document dans l'espace adhérents, section ${(response === null || response === void 0 ? void 0 : (_response$data = response.data) === null || _response$data === void 0 ? void 0 : (_response$data$themat = _response$data.thematique) === null || _response$data$themat === void 0 ? void 0 : _response$data$themat.titre) || 'inconnue'}.`,\n        emails,\n        senderEmail: user.email\n      };\n      const res = await sendResourceNotif(variables); // 4. Set Loader to false and success and variable to initial state\n\n      setVariables(initialState);\n      setSuccess('Votre document a bien été envoyé !');\n      setLoader(false);\n    } catch (error) {\n      console.log(error);\n      setLoader(false);\n      setError('Impossible de télécharger le document. Veuillez réessayer.');\n    }\n  };\n\n  if (loader) {\n    return /*#__PURE__*/_jsxDEV(LinearProgress, {\n      color: \"primary\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 7\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(Layout, {\n    children: /*#__PURE__*/_jsxDEV(Box, {\n      mt: 7,\n      children: /*#__PURE__*/_jsxDEV(Container, {\n        maxWidth: \"lg\",\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          direction: \"column\",\n          justify: \"center\",\n          alignItems: \"center\",\n          children: /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            xs: 10,\n            md: 8,\n            children: /*#__PURE__*/_jsxDEV(Paper, {\n              className: classes.paper,\n              children: [/*#__PURE__*/_jsxDEV(Box, {\n                mb: 2,\n                children: /*#__PURE__*/_jsxDEV(Text, {\n                  size: \"h5\",\n                  letterspacing: \"2px\",\n                  bold: true,\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    style: {\n                      color: '#e95e2e'\n                    },\n                    children: \"Proposer une ressource\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 148,\n                    columnNumber: 21\n                  }, this), ' ', /*#__PURE__*/_jsxDEV(\"span\", {\n                    style: {\n                      color: '#2699b0'\n                    },\n                    children: \"au r\\xE9seau\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 150,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 147,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 146,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                mb: 4,\n                children: /*#__PURE__*/_jsxDEV(Text, {\n                  size: \"body2\",\n                  bold: true,\n                  color: \"#4ba829\",\n                  children: \"Vous avez un nouveau projet, vous venez de signer une nouvelle convention, vous avez un article dans la presse, vous avez recrut\\xE9 un nouvel adh\\xE9rent, toutes les actualit\\xE9s sont les bienvenues ! N'h\\xE9sitez pas \\xE0 d\\xE9poser un fichier en format PDF pour que Mob'In en soit inform\\xE9 et puisse diffuser cette actualit\\xE9 aux autres membres du r\\xE9seau. Merci d'avance !\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 154,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 153,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Divider, {\n                color: \"#b1b3b4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 158,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                mt: 3,\n                mb: 2,\n                className: classes.textFieldBox,\n                children: [/*#__PURE__*/_jsxDEV(Box, {\n                  mt: 2,\n                  mb: 2,\n                  children: /*#__PURE__*/_jsxDEV(Text, {\n                    bold: true,\n                    size: \"body2\",\n                    children: \"T\\xE9l\\xE9charger un fichier\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 165,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 164,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Box, {\n                  mb: 3,\n                  children: /*#__PURE__*/_jsxDEV(Paper, {\n                    variant: \"outlined\",\n                    className: classes.paper2,\n                    children: /*#__PURE__*/_jsxDEV(\"div\", _objectSpread(_objectSpread({}, getRootProps()), {}, {\n                      children: [/*#__PURE__*/_jsxDEV(\"input\", _objectSpread({}, getInputProps()), void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 175,\n                        columnNumber: 27\n                      }, this), isDragActive ? /*#__PURE__*/_jsxDEV(Text, {\n                        children: \"T\\xE9l\\xE9chargez votre fichier PDF ici\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 178,\n                        columnNumber: 57\n                      }, this) : /*#__PURE__*/_jsxDEV(Text, {\n                        children: \"T\\xE9l\\xE9chargez votre fichier PDF ici\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 179,\n                        columnNumber: 57\n                      }, this), variables.fichier && /*#__PURE__*/_jsxDEV(Text, {\n                        bold: true,\n                        children: variables === null || variables === void 0 ? void 0 : (_variables$fichier = variables.fichier) === null || _variables$fichier === void 0 ? void 0 : _variables$fichier.name\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 183,\n                        columnNumber: 53\n                      }, this)]\n                    }), void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 174,\n                      columnNumber: 23\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 170,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 169,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Box, {\n                  mb: 2,\n                  children: /*#__PURE__*/_jsxDEV(TextField, {\n                    value: variables.titre,\n                    onChange: event => setVariables(_objectSpread(_objectSpread({}, variables), {}, {\n                      titre: event.target.value\n                    })),\n                    label: \"Titre\",\n                    variant: \"outlined\",\n                    size: \"small\",\n                    className: classes.textField\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 190,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 189,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Box, {\n                  mb: 3,\n                  children: /*#__PURE__*/_jsxDEV(FormControl, {\n                    className: classes.textField,\n                    children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n                      children: \"Th\\xE8me\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 203,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(Select, {\n                      value: variables.thematique || '',\n                      onChange: event => setVariables(_objectSpread(_objectSpread({}, variables), {}, {\n                        thematique: event.target.value\n                      })),\n                      children: themes.map((t, i) => /*#__PURE__*/_jsxDEV(MenuItem, {\n                        value: t,\n                        children: t.titre\n                      }, i, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 210,\n                        columnNumber: 55\n                      }, this))\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 204,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 200,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 199,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 159,\n                columnNumber: 17\n              }, this), error && /*#__PURE__*/_jsxDEV(Box, {\n                mt: 3,\n                mb: 2,\n                children: /*#__PURE__*/_jsxDEV(Text, {\n                  size: \"body1\",\n                  bold: true,\n                  color: \"#e5352c\",\n                  children: error\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 226,\n                  columnNumber: 39\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 225,\n                columnNumber: 37\n              }, this), success && /*#__PURE__*/_jsxDEV(Box, {\n                mt: 3,\n                mb: 2,\n                children: /*#__PURE__*/_jsxDEV(Text, {\n                  size: \"body1\",\n                  bold: true,\n                  color: \"#4ba829\",\n                  children: success\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 235,\n                  columnNumber: 39\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 234,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                mt: 3,\n                mb: 2,\n                className: classes.btnBox,\n                children: /*#__PURE__*/_jsxDEV(Button, {\n                  className: classes.btn,\n                  variant: \"outlined\",\n                  onClick: () => onSubmit(),\n                  children: \"Valider\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 246,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 241,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 145,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 135,\n    columnNumber: 5\n  }, this);\n};\n\nexport const getServerSideProps = async ctx => {\n  const req = ctx.req ? ctx.req : null;\n\n  if (req) {\n    const cookies = new Cookies(ctx.req, ctx.res);\n    const token = cookies.get('token');\n\n    if (token) {\n      const isTokValid = isTokenValid(token);\n\n      if (isTokValid) {\n        const res = await fetch(getThemes);\n        const themes = await res.json();\n        const res2 = await fetch(getContactEmails);\n        const emails = await res2.json();\n        return {\n          props: {\n            themes,\n            contactEmails: emails\n          }\n        };\n      }\n\n      ctx.res.writeHead(302, {\n        Location: '/'\n      });\n      ctx.res.end();\n      return {\n        props: {}\n      };\n    }\n\n    ctx.res.writeHead(302, {\n      Location: '/'\n    });\n    ctx.res.end();\n    return {\n      props: {}\n    };\n  }\n};\nexport default PrivateShareDocument;","map":{"version":3,"sources":["/Users/adriengrampone/Documents/A&F/mobin/frontend/pages/auth/proposer-document/index.js"],"names":["useState","useCallback","useContext","Container","Box","Grid","LinearProgress","Button","Paper","Divider","TextField","FormControl","Select","InputLabel","MenuItem","makeStyles","useDropzone","Cookies","Layout","Text","getThemes","getContactEmails","isTokenValid","postDocumentAdherent","AppContext","sendResourceNotif","useStyles","theme","paper","padding","border","palette","grey","main","paper2","blue","flexBox","display","alignItems","textField","minWidth","textFieldBox","btnBox","textAlign","btn","paddingLeft","paddingRight","color","fontWeight","letterSpacing","borderColor","borderRadius","backgroundColor","golden","PrivateShareDocument","themes","contactEmails","classes","user","initialState","titre","thematique","fichier","variables","setVariables","loader","setLoader","error","setError","success","setSuccess","onDrop","acceptedFiles","getRootProps","getInputProps","isDragActive","accept","onSubmit","length","Object","keys","formData","FormData","append","name","data","id","JSON","stringify","response","emails","map","e","email","message","senderEmail","res","console","log","event","target","value","t","i","getServerSideProps","ctx","req","cookies","token","get","isTokValid","fetch","json","res2","props","writeHead","Location","end"],"mappings":"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","sourcesContent":["import { useState, useCallback, useContext } from 'react';\nimport {\n  Container, Box, Grid, LinearProgress, Button, Paper, Divider, TextField, FormControl, Select, InputLabel, MenuItem,\n} from '@material-ui/core';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useDropzone } from 'react-dropzone';\nimport Cookies from 'cookies';\nimport { Layout, Text } from '../../../components';\nimport { getThemes, getContactEmails, isTokenValid } from '../../../utils';\nimport { postDocumentAdherent } from '../../../lib/ressources';\nimport AppContext from '../../../context/AppContext';\nimport { sendResourceNotif } from '../../../src/services/sendEmail';\n\nconst useStyles = makeStyles((theme) => ({\n  paper: {\n    padding: '2em',\n    border: `2px solid ${theme.palette.grey.main}`,\n  },\n  paper2: {\n    padding: '2em',\n    border: `0.5px solid ${theme.palette.blue.main}`,\n  },\n  flexBox: {\n    display: 'flex',\n    alignItems: 'center',\n  },\n  textField: {\n    minWidth: '100%',\n  },\n  textFieldBox: {\n    // textAlign: 'center'\n  },\n  btnBox: {\n    textAlign: 'center',\n  },\n  btn: {\n    paddingLeft: '2em',\n    paddingRight: '2em',\n    color: theme.palette.blue.main,\n    fontWeight: 'bold',\n    letterSpacing: '2px',\n    borderColor: theme.palette.grey.main,\n    borderRadius: '1.5em',\n    '&:hover': {\n      backgroundColor: theme.palette.golden.main,\n      color: '#fff',\n      borderColor: theme.palette.golden.main,\n    },\n  },\n}));\n\nconst PrivateShareDocument = ({ themes = [], contactEmails = [] }) => {\n  const classes = useStyles();\n  const { user } = useContext(AppContext);\n  const initialState = {\n    titre: '',\n    thematique: {},\n    fichier: null,\n  };\n  const [variables, setVariables] = useState(initialState);\n  const [loader, setLoader] = useState(false);\n  const [error, setError] = useState(null);\n  const [success, setSuccess] = useState(null);\n\n  const onDrop = useCallback((acceptedFiles) => {\n    setVariables({ ...variables, fichier: acceptedFiles[0] });\n  }, []);\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: '.pdf',\n  });\n\n  const onSubmit = async () => {\n    setLoader(true);\n    const { titre, thematique, fichier } = variables;\n    setError(null);\n\n    if (!fichier) {\n      setLoader(false);\n      setError('Merci de télécharger un document pdf.');\n      return;\n    }\n\n    if (titre.length < 1) {\n      setLoader(false);\n      setError('Un titre de document doit être saisi.');\n      return;\n    }\n\n    if (Object.keys(thematique).length < 1) {\n      setLoader(false);\n      setError('Merci de choisir une thématique.');\n      return;\n    }\n\n    try {\n      // 1. Create Form Data with Document\n      const formData = new FormData();\n      formData.append('files.fichier', fichier, fichier.name);\n      const data = {};\n      data.titre = titre;\n      data.thematique = thematique.id;\n      formData.append('data', JSON.stringify(data));\n\n      // 2. Post Form Data\n      const response = await postDocumentAdherent(formData);\n\n      // 3. Send Email Notif\n      const emails = contactEmails.map((e) => ({ email: e.email }));\n      const variables = {\n        message: `L'utilisateur ${user.email} a déposé un nouveau document dans l'espace adhérents, section ${response?.data?.thematique?.titre || 'inconnue'}.`,\n        emails,\n        senderEmail: user.email,\n      };\n      const res = await sendResourceNotif(variables);\n      // 4. Set Loader to false and success and variable to initial state\n      setVariables(initialState);\n      setSuccess('Votre document a bien été envoyé !');\n      setLoader(false);\n    } catch (error) {\n      console.log(error);\n      setLoader(false);\n      setError('Impossible de télécharger le document. Veuillez réessayer.');\n    }\n  };\n\n  if (loader) {\n    return (\n      <LinearProgress color=\"primary\" />\n    );\n  }\n\n  return (\n    <Layout>\n      <Box mt={7}>\n        <Container maxWidth=\"lg\">\n          <Grid\n            container\n            direction=\"column\"\n            justify=\"center\"\n            alignItems=\"center\"\n          >\n            <Grid item xs={10} md={8}>\n              <Paper className={classes.paper}>\n                <Box mb={2}>\n                  <Text size=\"h5\" letterspacing=\"2px\" bold>\n                    <span style={{ color: '#e95e2e' }}>Proposer une ressource</span>\n                    {' '}\n                    <span style={{ color: '#2699b0' }}>au réseau</span>\n                  </Text>\n                </Box>\n                <Box mb={4}>\n                  <Text size=\"body2\" bold color=\"#4ba829\">\n                    Vous avez un nouveau projet, vous venez de signer une nouvelle convention, vous avez un article dans la presse, vous avez recruté un nouvel adhérent, toutes les actualités sont les bienvenues ! N'hésitez pas à déposer un fichier en format PDF pour que Mob'In en soit informé et puisse diffuser cette actualité aux autres membres du réseau. Merci d'avance !\n                  </Text>\n                </Box>\n                <Divider color=\"#b1b3b4\" />\n                <Box\n                  mt={3}\n                  mb={2}\n                  className={classes.textFieldBox}\n                >\n                  <Box mt={2} mb={2}>\n                    <Text bold size=\"body2\">\n                      Télécharger un fichier\n                                        </Text>\n                  </Box>\n                  <Box mb={3}>\n                    <Paper\n                      variant=\"outlined\"\n                      className={classes.paper2}\n                    >\n                      <div {...getRootProps()}>\n                          <input {...getInputProps()} />\n                          {\n                                                    isDragActive\n                                                      ? <Text>Téléchargez votre fichier PDF ici</Text>\n                                                      : <Text>Téléchargez votre fichier PDF ici</Text>\n                                                }\n                          {\n                                                    variables.fichier && (\n                                                    <Text bold>{variables?.fichier?.name}</Text>\n                                                    )\n                                                }\n                        </div>\n                    </Paper>\n                  </Box>\n                  <Box mb={2}>\n                    <TextField\n                      value={variables.titre}\n                      onChange={(event) => setVariables({ ...variables, titre: event.target.value })}\n                      label=\"Titre\"\n                      variant=\"outlined\"\n                      size=\"small\"\n                      className={classes.textField}\n                    />\n                  </Box>\n                  <Box mb={3}>\n                    <FormControl\n                      className={classes.textField}\n                    >\n                      <InputLabel>Thème</InputLabel>\n                      <Select\n                          value={variables.thematique || ''}\n                          onChange={(event) => setVariables({ ...variables, thematique: event.target.value })}\n                        >\n                          {\n                                                    themes.map((t, i) => (\n                                                      <MenuItem\n                                                        key={i}\n                                                        value={t}\n                                                      >\n                                                        {t.titre}\n                                                      </MenuItem>\n                                                    ))\n                                                }\n                        </Select>\n                    </FormControl>\n                  </Box>\n\n                </Box>\n                {\n                                    error && (\n                                    <Box mt={3} mb={2}>\n                                      <Text size=\"body1\" bold color=\"#e5352c\">\n                                        {error}\n                                      </Text>\n                                    </Box>\n                                    )\n                                }\n                {\n                                    success && (\n                                    <Box mt={3} mb={2}>\n                                      <Text size=\"body1\" bold color=\"#4ba829\">\n                                        {success}\n                                      </Text>\n                                    </Box>\n                                    )\n                                }\n                <Box\n                  mt={3}\n                  mb={2}\n                  className={classes.btnBox}\n                >\n                  <Button className={classes.btn} variant=\"outlined\" onClick={() => onSubmit()}>\n                    Valider\n                  </Button>\n                </Box>\n              </Paper>\n            </Grid>\n          </Grid>\n        </Container>\n      </Box>\n    </Layout>\n  );\n};\n\nexport const getServerSideProps = async (ctx) => {\n  const req = ctx.req ? ctx.req : null;\n  if (req) {\n    const cookies = new Cookies(ctx.req, ctx.res);\n    const token = cookies.get('token');\n    if (token) {\n      const isTokValid = isTokenValid(token);\n      if (isTokValid) {\n        const res = await fetch(getThemes);\n        const themes = await res.json();\n        const res2 = await fetch(getContactEmails);\n        const emails = await res2.json();\n        return {\n          props: { themes, contactEmails: emails },\n        };\n      }\n      ctx.res.writeHead(302, { Location: '/' });\n      ctx.res.end();\n      return { props: {} };\n    }\n    ctx.res.writeHead(302, { Location: '/' });\n    ctx.res.end();\n    return { props: {} };\n  }\n};\n\nexport default PrivateShareDocument;\n"]},"metadata":{},"sourceType":"module"}