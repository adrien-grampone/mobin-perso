{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState, useCallback, useContext } from 'react';\nimport { Container, Box, Grid, LinearProgress, Button, Paper, Divider, TextField, FormControl, Select, InputLabel, MenuItem } from '@material-ui/core';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useDropzone } from 'react-dropzone';\nimport { Layout, Text } from '../../../components';\nimport { postDocumentAdherent } from '../../../lib/ressources';\nimport AppContext from '../../../context/AppContext';\nimport { sendResourceNotif } from '../../../src/services/sendEmail';\nvar useStyles = makeStyles(function (theme) {\n  return {\n    paper: {\n      padding: '2em',\n      border: \"2px solid \".concat(theme.palette.grey.main)\n    },\n    paper2: {\n      padding: '2em',\n      border: \"0.5px solid \".concat(theme.palette.blue.main)\n    },\n    flexBox: {\n      display: 'flex',\n      alignItems: 'center'\n    },\n    textField: {\n      minWidth: '100%'\n    },\n    textFieldBox: {// textAlign: 'center'\n    },\n    btnBox: {\n      textAlign: 'center'\n    },\n    btn: {\n      paddingLeft: '2em',\n      paddingRight: '2em',\n      color: theme.palette.blue.main,\n      fontWeight: 'bold',\n      letterSpacing: '2px',\n      borderColor: theme.palette.grey.main,\n      borderRadius: '1.5em',\n      '&:hover': {\n        backgroundColor: theme.palette.golden.main,\n        color: '#fff',\n        borderColor: theme.palette.golden.main\n      }\n    }\n  };\n});\n\nvar PrivateShareDocument = function PrivateShareDocument(_ref) {\n  var _variables$fichier;\n\n  var _ref$themes = _ref.themes,\n      themes = _ref$themes === void 0 ? [] : _ref$themes,\n      _ref$contactEmails = _ref.contactEmails,\n      contactEmails = _ref$contactEmails === void 0 ? [] : _ref$contactEmails;\n  var classes = useStyles();\n\n  var _useContext = useContext(AppContext),\n      user = _useContext.user;\n\n  var initialState = {\n    titre: '',\n    thematique: {},\n    fichier: null\n  };\n\n  var _useState = useState(initialState),\n      variables = _useState[0],\n      setVariables = _useState[1];\n\n  var _useState2 = useState(false),\n      loader = _useState2[0],\n      setLoader = _useState2[1];\n\n  var _useState3 = useState(null),\n      error = _useState3[0],\n      setError = _useState3[1];\n\n  var _useState4 = useState(null),\n      success = _useState4[0],\n      setSuccess = _useState4[1];\n\n  var onDrop = useCallback(function (acceptedFiles) {\n    setVariables(_objectSpread(_objectSpread({}, variables), {}, {\n      fichier: acceptedFiles[0]\n    }));\n  }, []);\n\n  var _useDropzone = useDropzone({\n    onDrop: onDrop,\n    accept: '.pdf'\n  }),\n      getRootProps = _useDropzone.getRootProps,\n      getInputProps = _useDropzone.getInputProps,\n      isDragActive = _useDropzone.isDragActive;\n\n  var onSubmit = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var titre, thematique, fichier, _response$data, _response$data$themat, formData, data, response, emails, _variables, res;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setLoader(true);\n              titre = variables.titre, thematique = variables.thematique, fichier = variables.fichier;\n              setError(null);\n\n              if (fichier) {\n                _context.next = 7;\n                break;\n              }\n\n              setLoader(false);\n              setError('Merci de télécharger un document pdf.');\n              return _context.abrupt(\"return\");\n\n            case 7:\n              if (!(titre.length < 1)) {\n                _context.next = 11;\n                break;\n              }\n\n              setLoader(false);\n              setError('Un titre de document doit être saisi.');\n              return _context.abrupt(\"return\");\n\n            case 11:\n              if (!(Object.keys(thematique).length < 1)) {\n                _context.next = 15;\n                break;\n              }\n\n              setLoader(false);\n              setError('Merci de choisir une thématique.');\n              return _context.abrupt(\"return\");\n\n            case 15:\n              _context.prev = 15;\n              // 1. Create Form Data with Document\n              formData = new FormData();\n              formData.append('files.fichier', fichier, fichier.name);\n              data = {};\n              data.titre = titre;\n              data.thematique = thematique.id;\n              formData.append('data', JSON.stringify(data)); // 2. Post Form Data\n\n              _context.next = 24;\n              return postDocumentAdherent(formData);\n\n            case 24:\n              response = _context.sent;\n              // 3. Send Email Notif\n              emails = contactEmails.map(function (e) {\n                return {\n                  email: e.email\n                };\n              });\n              _variables = {\n                message: \"L'utilisateur \".concat(user.email, \" a d\\xE9pos\\xE9 un nouveau document dans l'espace adh\\xE9rents, section \").concat((response === null || response === void 0 ? void 0 : (_response$data = response.data) === null || _response$data === void 0 ? void 0 : (_response$data$themat = _response$data.thematique) === null || _response$data$themat === void 0 ? void 0 : _response$data$themat.titre) || 'inconnue', \".\"),\n                emails: emails,\n                senderEmail: user.email\n              };\n              _context.next = 29;\n              return sendResourceNotif(_variables);\n\n            case 29:\n              res = _context.sent;\n              // 4. Set Loader to false and success and variable to initial state\n              setVariables(initialState);\n              setSuccess('Votre document a bien été envoyé !');\n              setLoader(false);\n              _context.next = 40;\n              break;\n\n            case 35:\n              _context.prev = 35;\n              _context.t0 = _context[\"catch\"](15);\n              console.log(_context.t0);\n              setLoader(false);\n              setError('Impossible de télécharger le document. Veuillez réessayer.');\n\n            case 40:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[15, 35]]);\n    }));\n\n    return function onSubmit() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  if (loader) {\n    return /*#__PURE__*/_jsx(LinearProgress, {\n      color: \"primary\"\n    });\n  }\n\n  return /*#__PURE__*/_jsx(Layout, {\n    children: /*#__PURE__*/_jsx(Box, {\n      mt: 7,\n      children: /*#__PURE__*/_jsx(Container, {\n        maxWidth: \"lg\",\n        children: /*#__PURE__*/_jsx(Grid, {\n          container: true,\n          direction: \"column\",\n          justify: \"center\",\n          alignItems: \"center\",\n          children: /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 10,\n            md: 8,\n            children: /*#__PURE__*/_jsxs(Paper, {\n              className: classes.paper,\n              children: [/*#__PURE__*/_jsx(Box, {\n                mb: 2,\n                children: /*#__PURE__*/_jsxs(Text, {\n                  size: \"h5\",\n                  letterspacing: \"2px\",\n                  bold: true,\n                  children: [/*#__PURE__*/_jsx(\"span\", {\n                    style: {\n                      color: '#e95e2e'\n                    },\n                    children: \"Proposer une ressource\"\n                  }), ' ', /*#__PURE__*/_jsx(\"span\", {\n                    style: {\n                      color: '#2699b0'\n                    },\n                    children: \"au r\\xE9seau\"\n                  })]\n                })\n              }), /*#__PURE__*/_jsx(Box, {\n                mb: 4,\n                children: /*#__PURE__*/_jsx(Text, {\n                  size: \"body2\",\n                  bold: true,\n                  color: \"#4ba829\",\n                  children: \"Vous avez un nouveau projet, vous venez de signer une nouvelle convention, vous avez un article dans la presse, vous avez recrut\\xE9 un nouvel adh\\xE9rent, toutes les actualit\\xE9s sont les bienvenues ! N'h\\xE9sitez pas \\xE0 d\\xE9poser un fichier en format PDF pour que Mob'In en soit inform\\xE9 et puisse diffuser cette actualit\\xE9 aux autres membres du r\\xE9seau. Merci d'avance !\"\n                })\n              }), /*#__PURE__*/_jsx(Divider, {\n                color: \"#b1b3b4\"\n              }), /*#__PURE__*/_jsxs(Box, {\n                mt: 3,\n                mb: 2,\n                className: classes.textFieldBox,\n                children: [/*#__PURE__*/_jsx(Box, {\n                  mt: 2,\n                  mb: 2,\n                  children: /*#__PURE__*/_jsx(Text, {\n                    bold: true,\n                    size: \"body2\",\n                    children: \"T\\xE9l\\xE9charger un fichier\"\n                  })\n                }), /*#__PURE__*/_jsx(Box, {\n                  mb: 3,\n                  children: /*#__PURE__*/_jsx(Paper, {\n                    variant: \"outlined\",\n                    className: classes.paper2,\n                    children: /*#__PURE__*/_jsxs(\"div\", _objectSpread(_objectSpread({}, getRootProps()), {}, {\n                      children: [/*#__PURE__*/_jsx(\"input\", _objectSpread({}, getInputProps())), isDragActive ? /*#__PURE__*/_jsx(Text, {\n                        children: \"T\\xE9l\\xE9chargez votre fichier PDF ici\"\n                      }) : /*#__PURE__*/_jsx(Text, {\n                        children: \"T\\xE9l\\xE9chargez votre fichier PDF ici\"\n                      }), variables.fichier && /*#__PURE__*/_jsx(Text, {\n                        bold: true,\n                        children: variables === null || variables === void 0 ? void 0 : (_variables$fichier = variables.fichier) === null || _variables$fichier === void 0 ? void 0 : _variables$fichier.name\n                      })]\n                    }))\n                  })\n                }), /*#__PURE__*/_jsx(Box, {\n                  mb: 2,\n                  children: /*#__PURE__*/_jsx(TextField, {\n                    value: variables.titre,\n                    onChange: function onChange(event) {\n                      return setVariables(_objectSpread(_objectSpread({}, variables), {}, {\n                        titre: event.target.value\n                      }));\n                    },\n                    label: \"Titre\",\n                    variant: \"outlined\",\n                    size: \"small\",\n                    className: classes.textField\n                  })\n                }), /*#__PURE__*/_jsx(Box, {\n                  mb: 3,\n                  children: /*#__PURE__*/_jsxs(FormControl, {\n                    className: classes.textField,\n                    children: [/*#__PURE__*/_jsx(InputLabel, {\n                      children: \"Th\\xE8me\"\n                    }), /*#__PURE__*/_jsx(Select, {\n                      value: variables.thematique || '',\n                      onChange: function onChange(event) {\n                        return setVariables(_objectSpread(_objectSpread({}, variables), {}, {\n                          thematique: event.target.value\n                        }));\n                      },\n                      children: themes.map(function (t, i) {\n                        return /*#__PURE__*/_jsx(MenuItem, {\n                          value: t,\n                          children: t.titre\n                        }, i);\n                      })\n                    })]\n                  })\n                })]\n              }), error && /*#__PURE__*/_jsx(Box, {\n                mt: 3,\n                mb: 2,\n                children: /*#__PURE__*/_jsx(Text, {\n                  size: \"body1\",\n                  bold: true,\n                  color: \"#e5352c\",\n                  children: error\n                })\n              }), success && /*#__PURE__*/_jsx(Box, {\n                mt: 3,\n                mb: 2,\n                children: /*#__PURE__*/_jsx(Text, {\n                  size: \"body1\",\n                  bold: true,\n                  color: \"#4ba829\",\n                  children: success\n                })\n              }), /*#__PURE__*/_jsx(Box, {\n                mt: 3,\n                mb: 2,\n                className: classes.btnBox,\n                children: /*#__PURE__*/_jsx(Button, {\n                  className: classes.btn,\n                  variant: \"outlined\",\n                  onClick: function onClick() {\n                    return onSubmit();\n                  },\n                  children: \"Valider\"\n                })\n              })]\n            })\n          })\n        })\n      })\n    })\n  });\n};\n\nexport var __N_SSP = true;\nexport default PrivateShareDocument;","map":null,"metadata":{},"sourceType":"module"}